# 24 Октября

Пару дней ощущения были не самые приятные, вроде бы "магнитки" закончиться уже должны, были но меня догоняют :-) Один раз забыл выпить таблетку от давления, а это еще пол дня не самых приятных ощущений :-)
Сегодня еще так себе, но уже более активно возможно получиться что то поделать во второй половине дня. Все еще размышляю как двигаться дальше, много чего стало попадаться что заставляет подумать :-) И это полезно я думаю :-)

## Статус по Huly

- Доделал устроившие меня на текущий момент рейтинги, влили уже по утру. +5000 строк кода, пока что без тестов, не знаю много это ли не много. Для тестов время дойдет, в начале хочется погонять на наших stating данных, чтобы понять что получилось.
  В итоге задача заняла неделю, хотя думал что закончу за пару дней, но появились дополнительные хотелки, но больше всего времени отлаживал как строятся собственно уровни и рейтинги, и считал статистику. Добавил возможность смотреть уровень пространства, можно будет одним запросом к базе понять насколько пространством пользуются, а еще парочкой кто и в каком объеме из пользователей максимально активный.
  На мой взгляд получилось полезно, часть про установку звезддочек и отдельную панельку вообще мне кажется буду использовать постоянно, чтобы не вспоминать где я какие документы оставил, а сразу все в одном месте.

## Как это работает

- Сервис рейтингов, висит на трубе в Kafka(RedPanda) в нашем случае, переписывает сообщения которые подходят для индексации в свою очередь обработки, сделано для того чтобы можно было спокойно тригеррить ре-индексацию, и за одно отбросить всякие события которые я точно знаю что не влияют на рейтинг, а потом можно в N потоков пересчитывать рейтинги, за 1 проход по табличке транзакций, и досчитывать по мере того как люди меняют данные. Загрузка довольно мелкая, но на создания документов приходится лазить на автором транзакции (LRU Cached само собой), и если документ вложенный за его родителем, чтобы найти автора документа, и если ему поставили звездочку поднять ему чуток рейтинг :-) Попутно записываю статистику по каждому кто что делает :-)

Минусы, про которые я знаю но оставил пока так:

- Вьюшка для элементов со звездочками требует выполнения несклоких запросов для каждого класса, и нету лимитов, но я не думаю что пользователи сразу нафигачат кучу звездочек на все подряд и будут в этом копаться, если сделают буду думать :-) Значит уже зайдет.
- Не стал делать информирование о достижении следующих уровней, нужно делать вместе с бейджами чтобы не захламливать пользователя, еще думаю когда к этому приступить если вообще приступлю.
  Нужно ли это реальным пользователем, не проверишь не узнаешь, главное как подать в начале опробуем на себе.
- Не стал делать рейтинг всех пользователей по уровням, возможно понадобиться но механизм не позволяет вставить в левую панельку в приложение Контакты, а городить отдельное не хотелось, как сделаю механизм, была еще идея перенести HR модуль сразу туда же в контакты.

Сегодня по мере сил смотрю в сторону встраивания в наши редакторы компонентов, которые смогут делать запросы и пользовательским образом рендерить контент, или в отчет или в диаграмму, или динамически или статически. Есть идеи как все это сделать, но нужно в начале поиграться и сделать прототипчег.

## Немного в картинках

### Мой рейтинг

Тут мой рейтинг в тестовом пространстве, уровни пока считаются может сильно быстро, по шагам отлажу понемногу, если руки дойдут, или может кто займется :-)

![001](./imgs/008/001.png)

А тут в профиле, еще и видно с какого socialID я больше всего наконтрибутил.

![001](./imgs/008/003.png)

### Тут статистика по пространству

![002](./imgs/008/002.png)

И расчеты по дампу платформы, но данные у меня какие то кривые были, на свежем посмотрю уже на живом.

![001](./imgs/008/005.png)

А тут для овнеров пространств можно будет посмотреть в процентах где сколько чего делали от общего обьема всех активностей.

![001](./imgs/008/006.png)

### Профиль другого участника системы

Спасибо @Denis Bykhov за данные :-)

![001](./imgs/008/004.png)
